import React, { useState } from 'react';
import { Star, Edit2, Trash2, Package, ThumbsUp, Calendar, CheckCircle, X } from 'lucide-react';

interface Review {
  id: string;
  productName: string;
  productImage: string;
  rating: number;
  title: string;
  description: string;
  date: string;
  verified: boolean;
  helpful: number;
}

const MyReviewsPage: React.FC = () => {
  const [reviews, setReviews] = useState<Review[]>([
    {
      id: '1',
      productName: 'Wireless Bluetooth Headphones Pro',
      productImage: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300&h=300&fit=crop',
      rating: 5,
      title: 'Exceptional Sound Quality and Comfort!',
      description: 'These headphones have completely exceeded my expectations. The bass is incredibly deep and punchy, the mids are crystal clear, and the highs are crisp without being harsh. The noise cancellation works flawlessly, and I can wear them for hours without any discomfort. Battery life easily lasts 2-3 days with moderate use. Worth every penny!',
      date: '2025-12-05',
      verified: true,
      helpful: 47
    },
    {
      id: '2',
      productName: 'Smart Watch Series 7 - GPS + Cellular',
      productImage: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=300&h=300&fit=crop',
      rating: 4,
      title: 'Great Features but Battery Life Could Be Better',
      description: 'I absolutely love the fitness tracking features and the AMOLED display is stunning. The heart rate monitor is accurate, and the GPS tracking is spot-on. However, with always-on display and heavy use, the battery barely lasts a full day. I wish it could go at least 2 days between charges. Otherwise, it is an excellent smartwatch.',
      date: '2025-11-28',
      verified: true,
      helpful: 32
    },
    {
      id: '3',
      productName: 'Premium Laptop Backpack with USB Charging Port',
      productImage: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=300&h=300&fit=crop',
      rating: 3,
      title: 'Functional but Material Quality is Average',
      description: 'The backpack is quite functional and has plenty of compartments for organizing my laptop, charger, and other accessories. The USB charging port is a nice touch. However, the material feels somewhat cheap and I am worried about its long-term durability. For the price, I expected better quality materials.',
      date: '2025-11-15',
      verified: true,
      helpful: 18
    },
    {
      id: '4',
      productName: 'Mechanical Gaming Keyboard RGB',
      productImage: 'https://images.unsplash.com/photo-1587829741301-dc798b83add3?w=300&h=300&fit=crop',
      rating: 5,
      title: 'Best Keyboard I Have Ever Used!',
      description: 'The typing experience is phenomenal. The mechanical switches feel amazing and the RGB lighting is fully customizable. Build quality is solid, and the software allows for extensive macro programming. Gaming and typing both feel great. Highly recommended for gamers and programmers alike!',
      date: '2025-10-22',
      verified: false,
      helpful: 56
    },
    {
      id: '5',
      productName: 'Portable Power Bank 20000mAh',
      productImage: 'https://images.unsplash.com/photo-1609091839311-d5365f9ff1c5?w=300&h=300&fit=crop',
      rating: 4,
      title: 'Reliable Power, Slightly Heavy',
      description: 'This power bank charges my phone multiple times and supports fast charging. The LED indicator is helpful. My only complaint is that it is a bit heavy to carry around every day, but the capacity makes up for it. Great for travel!',
      date: '2025-10-10',
      verified: true,
      helpful: 23
    }
  ]);

  const [editingReview, setEditingReview] = useState<Review | null>(null);
  const [deleteConfirmId, setDeleteConfirmId] = useState<string | null>(null);
  const [editForm, setEditForm] = useState({
    rating: 5,
    title: '',
    description: ''
  });

  // Calculate stats
  const totalReviews = reviews.length;
  const averageRating = totalReviews > 0 
    ? (reviews.reduce((sum, r) => sum + r.rating, 0) / totalReviews).toFixed(1)
    : '0.0';
  const totalHelpful = reviews.reduce((sum, r) => sum + r.helpful, 0);

  const handleEditClick = (review: Review) => {
    setEditingReview(review);
    setEditForm({
      rating: review.rating,
      title: review.title,
      description: review.description
    });
  };

  const handleSaveEdit = () => {
    if (!editingReview) return;
    
    setReviews(reviews.map(review => 
      review.id === editingReview.id
        ? { ...review, ...editForm }
        : review
    ));
    setEditingReview(null);
  };

  const handleDelete = (id: string) => {
    setReviews(reviews.filter(review => review.id !== id));
    setDeleteConfirmId(null);
  };

  const renderStars = (rating: number, onRatingChange?: (rating: number) => void, interactive: boolean = false) => {
    return (
      <div className="flex gap-1">
        {[1, 2, 3, 4, 5].map((star) => (
          <Star
            key={star}
            onClick={() => interactive && onRatingChange && onRatingChange(star)}
            className={`w-5 h-5 transition-colors ${
              interactive ? 'cursor-pointer hover:scale-110' : ''
            } ${
              star <= rating ? 'fill-yellow-400 text-yellow-400' : 'text-gray-300'
            }`}
          />
        ))}
      </div>
    );
  };

  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
      {/* Header */}
      <div className="bg-white shadow-md border-b border-gray-200">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <h1 className="text-4xl font-bold text-gray-900 mb-2">My Reviews</h1>
          <p className="text-gray-600 text-lg">View and manage all your product reviews</p>
        </div>
      </div>

      {/* Main Content */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Stats Dashboard */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
          <div className="bg-white rounded-2xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-500 text-sm font-medium uppercase tracking-wide">Total Reviews</p>
                <p className="text-4xl font-bold text-gray-900 mt-2">{totalReviews}</p>
              </div>
              <div className="bg-blue-100 p-4 rounded-xl">
                <Package className="w-8 h-8 text-blue-600" />
              </div>
            </div>
          </div>
          
          <div className="bg-white rounded-2xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-500 text-sm font-medium uppercase tracking-wide">Average Rating</p>
                <div className="flex items-center gap-2 mt-2">
                  <p className="text-4xl font-bold text-gray-900">{averageRating}</p>
                  <Star className="w-6 h-6 text-yellow-500 fill-yellow-500" />
                </div>
              </div>
              <div className="bg-yellow-100 p-4 rounded-xl">
                <Star className="w-8 h-8 text-yellow-600 fill-yellow-600" />
              </div>
            </div>
          </div>
          
          <div className="bg-white rounded-2xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow sm:col-span-2 lg:col-span-1">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-500 text-sm font-medium uppercase tracking-wide">Total Helpful Votes</p>
                <p className="text-4xl font-bold text-gray-900 mt-2">{totalHelpful}</p>
              </div>
              <div className="bg-green-100 p-4 rounded-xl">
                <ThumbsUp className="w-8 h-8 text-green-600" />
              </div>
            </div>
          </div>
        </div>

        {/* Reviews List */}
        <div className="space-y-6">
          {reviews.length === 0 ? (
            <div className="bg-white rounded-2xl shadow-lg p-16 text-center border border-gray-100">
              <div className="bg-gray-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                <Package className="w-12 h-12 text-gray-400" />
              </div>
              <h3 className="text-2xl font-bold text-gray-900 mb-3">No Reviews Yet</h3>
              <p className="text-gray-600 text-lg">Start reviewing products you have purchased to help others!</p>
            </div>
          ) : (
            reviews.map((review) => (
              <div key={review.id} className="bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all border border-gray-100">
                <div className="p-6 sm:p-8">
                  <div className="flex flex-col sm:flex-row gap-6">
                    {/* Product Image */}
                    <div className="flex-shrink-0">
                      <img
                        src={review.productImage}
                        alt={review.productName}
                        className="w-full sm:w-32 h-48 sm:h-32 object-cover rounded-xl shadow-md"
                      />
                    </div>

                    {/* Review Content */}
                    <div className="flex-1 min-w-0">
                      <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 mb-4">
                        <div className="flex-1">
                          <h3 className="text-xl font-bold text-gray-900 mb-3 leading-tight">
                            {review.productName}
                          </h3>
                          <div className="flex flex-wrap items-center gap-3 mb-3">
                            {renderStars(review.rating)}
                            {review.verified && (
                              <div className="flex items-center gap-1.5 bg-green-50 text-green-700 px-3 py-1.5 rounded-full text-sm font-medium border border-green-200">
                                <CheckCircle className="w-4 h-4" />
                                <span>Verified Purchase</span>
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Action Buttons */}
                        <div className="flex gap-2 self-start">
                          <button
                            onClick={() => handleEditClick(review)}
                            className="flex items-center gap-2 px-4 py-2 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-xl transition-colors font-medium"
                            title="Edit Review"
                          >
                            <Edit2 className="w-4 h-4" />
                            <span className="hidden sm:inline">Edit</span>
                          </button>
                          <button
                            onClick={() => setDeleteConfirmId(review.id)}
                            className="flex items-center gap-2 px-4 py-2 text-red-600 bg-red-50 hover:bg-red-100 rounded-xl transition-colors font-medium"
                            title="Delete Review"
                          >
                            <Trash2 className="w-4 h-4" />
                            <span className="hidden sm:inline">Delete</span>
                          </button>
                        </div>
                      </div>

                      <h4 className="text-lg font-bold text-gray-900 mb-3">{review.title}</h4>
                      <p className="text-gray-700 mb-4 leading-relaxed">{review.description}</p>

                      <div className="flex flex-wrap items-center gap-4 text-sm text-gray-600 pt-4 border-t border-gray-100">
                        <div className="flex items-center gap-2">
                          <Calendar className="w-4 h-4" />
                          <span>{formatDate(review.date)}</span>
                        </div>
                        <span className="hidden sm:inline">â€¢</span>
                        <div className="flex items-center gap-2">
                          <ThumbsUp className="w-4 h-4" />
                          <span className="font-medium">{review.helpful} people</span>
                          <span>found this helpful</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            ))
          )}
        </div>
      </div>

      {/* Edit Modal */}
      {editingReview && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-2xl">
              <h2 className="text-2xl font-bold text-gray-900">Edit Review</h2>
              <button
                onClick={() => setEditingReview(null)}
                className="text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-lg"
              >
                <X className="w-6 h-6" />
              </button>
            </div>
            
            <div className="p-6 space-y-6">
              <div className="flex items-center gap-4 pb-6 border-b border-gray-100">
                <img
                  src={editingReview.productImage}
                  alt={editingReview.productName}
                  className="w-20 h-20 object-cover rounded-xl shadow-md"
                />
                <div>
                  <h3 className="font-bold text-gray-900 text-lg">{editingReview.productName}</h3>
                  {editingReview.verified && (
                    <div className="flex items-center gap-1.5 text-green-700 text-sm mt-1">
                      <CheckCircle className="w-4 h-4" />
                      <span>Verified Purchase</span>
                    </div>
                  )}
                </div>
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-900 mb-3">
                  Your Rating *
                </label>
                {renderStars(
                  editForm.rating,
                  (rating) => setEditForm({ ...editForm, rating }),
                  true
                )}
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-900 mb-2">
                  Review Title *
                </label>
                <input
                  type="text"
                  value={editForm.title}
                  onChange={(e) => setEditForm({ ...editForm, title: e.target.value })}
                  className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                  placeholder="Summarize your experience"
                />
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-900 mb-2">
                  Review Description *
                </label>
                <textarea
                  value={editForm.description}
                  onChange={(e) => setEditForm({ ...editForm, description: e.target.value })}
                  rows={6}
                  className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"
                  placeholder="Share your detailed experience with this product"
                />
              </div>

              <div className="flex gap-3 pt-4">
                <button
                  onClick={handleSaveEdit}
                  disabled={!editForm.title.trim() || !editForm.description.trim()}
                  className="flex-1 bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-semibold text-lg"
                >
                  Save Changes
                </button>
                <button
                  onClick={() => setEditingReview(null)}
                  className="flex-1 bg-gray-100 text-gray-700 px-6 py-3 rounded-xl hover:bg-gray-200 transition-colors font-semibold text-lg"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Delete Confirmation Modal */}
      {deleteConfirmId && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
            <div className="text-center mb-6">
              <div className="bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <Trash2 className="w-8 h-8 text-red-600" />
              </div>
              <h2 className="text-2xl font-bold text-gray-900 mb-2">Delete Review?</h2>
              <p className="text-gray-600">
                Are you sure you want to delete this review? This action cannot be undone.
              </p>
            </div>
            
            <div className="flex gap-3">
              <button
                onClick={() => handleDelete(deleteConfirmId)}
                className="flex-1 bg-red-600 text-white px-6 py-3 rounded-xl hover:bg-red-700 transition-colors font-semibold"
              >
                Yes, Delete
              </button>
              <button
                onClick={() => setDeleteConfirmId(null)}
                className="flex-1 bg-gray-100 text-gray-700 px-6 py-3 rounded-xl hover:bg-gray-200 transition-colors font-semibold"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default MyReviewsPage;