ğŸš¨ğŸš¨ğŸš¨ EXECUTION LOCK â€” ABSOLUTE ENFORCEMENT ğŸš¨ğŸš¨ğŸš¨

THIS IS A HARD EXECUTION CONTRACT.

You MUST follow this prompt LINE BY LINE.
You are NOT allowed to:
- Skip
- Summarize
- Merge
- Stub
- Partially implement
- Replace with pseudo-code
- Defer work to â€œlaterâ€

If ANY instruction is violated â†’ YOU MUST STOP
and PRINT ONLY THIS LINE:

"EXECUTION FAILED â€” REQUIREMENTS NOT FULLY MET"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ROLE & AUTHORITY (LOCKED)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You are a Principal / Staff-level Backend Engineer
with production experience on
FirstCry / Amazon / Flipkart-scale systems.

You are building a **REAL production backend**.
This is NOT a demo.
This is NOT a tutorial.

Frontend (React Native) ALREADY EXISTS.
Your backend MUST align exactly with it.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TECH STACK (IMMUTABLE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

- Backend: FastAPI (Python)
- Database: PostgreSQL
- ORM: SQLAlchemy
- Migrations: Alembic

âŒ NO frontend code  
âŒ NO UI logic  
âŒ NO payment gateway SDK  
âŒ NO mock / fake logic  

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ABSOLUTE SYSTEM RULES (NO EXCEPTIONS)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. You MUST analyze frontend flows BEFORE writing code
2. You MUST NOT use procedures for read-only queries
3. Database is FINAL authority for:
   - inventory
   - pricing
   - coupons
   - order state
   - payments
4. EVERY database procedure MUST:
   - Be written as FULL PostgreSQL SQL
   - Be stored ONLY as `.sql` files
   - Live ONLY inside `/procedures/`
5. NO procedure may be auto-executed
6. NO procedure may be incomplete
7. NO procedure may lack transaction control
8. NO procedure may lack error handling
9. NO procedure may lack proper locking where applicable

Violation of ANY rule = FAILURE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
CRITICAL SQL BODY REQUIREMENT (HARD)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

FOR **EVERY SINGLE PROCEDURE** you MUST include:

âœ” CREATE OR REPLACE PROCEDURE  
âœ” Explicit INPUT PARAMETERS  
âœ” LANGUAGE plpgsql  
âœ” BEGIN â€¦ COMMIT â€¦ ROLLBACK  
âœ” SELECT â€¦ FOR UPDATE (where inventory / coupon / payment / order involved)  
âœ” EXCEPTION WHEN OTHERS THEN  
âœ” ROLLBACK + RAISE  

âŒ Functions are NOT allowed  
âŒ Partial SQL is NOT allowed  
âŒ TODO comments are NOT allowed  

If even ONE procedure violates this â†’ FAILURE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 1 â€” FRONTEND FLOW ANALYSIS (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You MUST first DOCUMENT (text only):

Home â†’ PLP â†’ PDP â†’ Cart â†’ Checkout â†’ Payment â†’ Orders

For EACH step, explicitly list:
- Read-only operations
- Write-critical operations
- Inventory touchpoints
- Coupon touchpoints
- Payment touchpoints

If this analysis is missing â†’ STOP.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 2 â€” FASTAPI BOILERPLATE (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You MUST generate the COMPLETE backend structure:

backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â””â”€â”€ security.py
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ routes/
â”‚   â””â”€â”€ utils/
â”‚
â”œâ”€â”€ procedures/     â† SQL FILES ONLY
â”œâ”€â”€ migrations/
â”œâ”€â”€ docs/
â””â”€â”€ README.md

The app MUST boot with:
uvicorn app.main:app

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 3 â€” ER DIAGRAM (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You MUST fully define schema for:

users  
otp_verifications  
categories  
products  
product_images  
inventory  
carts  
cart_items  
wishlists  
orders  
order_items  
payments  
refunds  
coupons  
coupon_usage  
addresses  

For EACH table:
- PK
- FK
- Indexes
- Relationships

Missing ANY table â†’ FAILURE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 4 â€” DATABASE PROCEDURES (NO EXCEPTIONS)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You MUST create **INDIVIDUAL .sql FILES**
for EACH procedure listed below.

EVERY FILE MUST CONTAIN A FULL SQL BODY.

â”â”â”â”â”â”â”â”â”â” AUTH
send_otp.sql  
verify_otp.sql  

â”â”â”â”â”â”â”â”â”â” CART
add_to_cart.sql  
update_cart_quantity.sql  
validate_cart_before_checkout.sql  

â”â”â”â”â”â”â”â”â”â” INVENTORY (CRITICAL)
lock_inventory.sql  
release_inventory.sql  
decrease_inventory.sql  
increase_inventory.sql  

â”â”â”â”â”â”â”â”â”â” COUPONS
apply_coupon.sql  
rollback_coupon.sql  
validate_coupon_usage_limit.sql  

â”â”â”â”â”â”â”â”â”â” ORDER
create_order.sql  
cancel_order.sql  
update_order_status.sql  

â”â”â”â”â”â”â”â”â”â” ORDER PRICING
freeze_order_pricing.sql  

â”â”â”â”â”â”â”â”â”â” PAYMENT
register_payment_attempt.sql  
verify_payment.sql  
payment_webhook.sql  

â”â”â”â”â”â”â”â”â”â” REFUND
initiate_refund.sql  
restore_inventory.sql  

âŒ DO NOT CREATE procedures for:
Home / PLP / PDP / Search / Wishlist / Address CRUD / Profile

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 5 â€” API CONTRACT (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

For EVERY API:
- Endpoint
- Method
- Request schema
- Response schema
- Error cases

APIs MUST map exactly to frontend needs.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 6 â€” SERVICE & REPOSITORY ENFORCEMENT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Service layer:
- Orchestrates workflows
- Calls procedures
- Handles failures

Repository layer:
- READ-ONLY queries ONLY
- ZERO business logic

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 7 â€” SCALABILITY ROADMAP (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Explain evolution:

1L users â†’ indexing  
10L users â†’ Redis + replicas  
1Cr users â†’ sharding + queues + observability  

Explain WHY for each stage.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FINAL VALIDATION (NO MERCY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You MUST explicitly CONFIRM ALL:

â˜ Frontend flow analysis done  
â˜ FastAPI boots successfully  
â˜ ER diagram complete  
â˜ EVERY procedure has FULL SQL body  
â˜ BEGIN / COMMIT / ROLLBACK everywhere  
â˜ SELECT FOR UPDATE used correctly  
â˜ EXCEPTION handling everywhere  
â˜ All procedures stored ONLY as `.sql`  
â˜ NOTHING auto-executed  

If ANY checkbox is false â†’ FAILURE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FINAL EXECUTION OATH (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Before ending, you MUST print:

"I CONFIRM:
- No instruction was skipped
- No procedure was partial
- No SQL was stubbed
- This backend is production-ready at FirstCry scale

If this is untrue, this output is INVALID."
