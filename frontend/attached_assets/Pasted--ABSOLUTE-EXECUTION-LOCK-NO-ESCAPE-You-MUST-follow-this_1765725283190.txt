ğŸš¨ğŸš¨ğŸš¨ ABSOLUTE EXECUTION LOCK â€” NO ESCAPE ğŸš¨ğŸš¨ğŸš¨

You MUST follow this prompt EXACTLY as written.
You are NOT allowed to:
- Skip
- Summarize
- Merge
- Stub
- Partially implement
- Defer implementation due to â€œfrontend missingâ€

If ANY requirement is missed â†’ STOP and OUTPUT ONLY:
"EXECUTION FAILED â€” BACKEND NOT 100% COMPLETE"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ROLE & AUTHORITY (LOCKED)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You are a Principal / Staff-level Backend Engineer
with real production experience on
FirstCry / Amazon / Flipkart-scale systems.

You are building a **COMPLETE, PRODUCTION-READY BACKEND**.

IMPORTANT:
- Frontend MAY be partially implemented
- Frontend MAY be incomplete
- Frontend MAY change later

ğŸš¨ REGARDLESS OF FRONTEND STATUS:
YOU MUST BUILD A **FULL BACKEND**.

Backend completeness is NON-NEGOTIABLE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TECH STACK (IMMUTABLE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

- Backend: FastAPI (Python)
- Database: PostgreSQL
- ORM: SQLAlchemy
- Migrations: Alembic

âŒ NO frontend code  
âŒ NO UI logic  
âŒ NO payment gateway SDK  
âŒ NO pseudo-code  

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ABSOLUTE SYSTEM RULES (NO EXCEPTIONS)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Backend MUST be COMPLETE even if frontend is incomplete
2. You MUST infer missing frontend needs using industry norms
3. DB is FINAL authority for:
   - inventory
   - pricing
   - coupons
   - order state
   - payments
4. ALL business-critical logic MUST live in PostgreSQL procedures
5. ALL procedures MUST be:
   - FULL PostgreSQL SQL (PL/pgSQL)
   - Stored ONLY as `.sql` files
   - Inside `/procedures/`
   - NOT auto-executed
6. NO read-only logic in procedures
7. NO stub / TODO / placeholder SQL allowed

Violation of ANY rule = FAILURE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
CRITICAL SQL BODY REQUIREMENT (HARD)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

FOR **EVERY PROCEDURE**, you MUST include:

âœ” CREATE OR REPLACE PROCEDURE  
âœ” Explicit INPUT PARAMETERS  
âœ” LANGUAGE plpgsql  
âœ” BEGIN / COMMIT / ROLLBACK  
âœ” SELECT â€¦ FOR UPDATE (where applicable)  
âœ” EXCEPTION WHEN OTHERS THEN  
âœ” ROLLBACK + RAISE  

âŒ NO functions  
âŒ NO partial SQL  
âŒ NO pseudo logic  

ALL procedures must be COPY-PASTE-READY.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 1 â€” BUSINESS FLOW ANALYSIS (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Analyze COMPLETE e-commerce flow EVEN IF frontend is incomplete:

- Authentication
- Product catalog
- Inventory
- Cart
- Coupons
- Checkout
- Payment
- Orders
- Refunds
- User profile

Document:
- Read-only operations
- Write-critical operations
- Money / stock / coupon touchpoints

If analysis is missing â†’ FAILURE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 2 â€” COMPLETE FASTAPI BOILERPLATE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You MUST generate a FULL backend structure:

backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â””â”€â”€ security.py
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ routes/
â”‚   â””â”€â”€ utils/
â”‚
â”œâ”€â”€ procedures/     â† SQL FILES ONLY
â”œâ”€â”€ migrations/
â”œâ”€â”€ docs/
â””â”€â”€ README.md

Backend MUST boot with:
uvicorn app.main:app

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 3 â€” COMPLETE ER DIAGRAM (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Design FULL schema covering ALL realistic needs:

users  
otp_verifications  
categories  
products  
product_images  
inventory  
carts  
cart_items  
wishlists  
orders  
order_items  
payments  
refunds  
coupons  
coupon_usage  
addresses  

For EACH table:
- PK
- FK
- Indexes
- Relationships

Missing ANY table = FAILURE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 4 â€” DATABASE PROCEDURES (ZERO TOLERANCE)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You MUST write FULL SQL bodies for ALL procedures below.

EACH procedure = ONE `.sql` file in `/procedures/`.

â”â”â”â”â”â”â”â”â”â” AUTH
send_otp.sql  
verify_otp.sql  

â”â”â”â”â”â”â”â”â”â” CART
add_to_cart.sql  
update_cart_quantity.sql  
validate_cart_before_checkout.sql  

â”â”â”â”â”â”â”â”â”â” INVENTORY (CRITICAL)
lock_inventory.sql  
release_inventory.sql  
decrease_inventory.sql  
increase_inventory.sql  

â”â”â”â”â”â”â”â”â”â” COUPONS
apply_coupon.sql  
rollback_coupon.sql  
validate_coupon_usage_limit.sql  

â”â”â”â”â”â”â”â”â”â” ORDER
create_order.sql  
cancel_order.sql  
update_order_status.sql  

â”â”â”â”â”â”â”â”â”â” ORDER PRICING
freeze_order_pricing.sql  

â”â”â”â”â”â”â”â”â”â” PAYMENT
register_payment_attempt.sql  
verify_payment.sql  
payment_webhook.sql  

â”â”â”â”â”â”â”â”â”â” REFUND
initiate_refund.sql  
restore_inventory.sql  

âŒ DO NOT CREATE procedures for:
Home / PLP / PDP / Search / Wishlist / Address CRUD / Profile

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 5 â€” COMPLETE API CONTRACT (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Define APIs EVEN IF frontend does not yet use them:

- Auth
- Product catalog
- Inventory checks
- Cart
- Coupons
- Checkout
- Payment
- Orders
- Refunds
- Profile

For EACH API:
- Endpoint
- Method
- Request schema
- Response schema
- Error cases

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 6 â€” SERVICE & REPOSITORY ENFORCEMENT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Service layer:
- Orchestrates workflows
- Calls procedures
- Handles retries & failures

Repository layer:
- READ-ONLY queries ONLY
- ZERO business logic

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STEP 7 â€” SCALABILITY ROADMAP (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Explain scaling plan:

1L users â†’ indexing  
10L users â†’ Redis + replicas  
1Cr users â†’ sharding + queues + observability  

Explain WHY for each stage.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FINAL VALIDATION (NO MERCY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

You MUST explicitly CONFIRM ALL:

â˜ Backend complete even without frontend  
â˜ FastAPI boots successfully  
â˜ ER diagram complete  
â˜ ALL procedures have FULL SQL bodies  
â˜ Transactions, locks, exceptions everywhere  
â˜ Procedures stored ONLY as `.sql`  
â˜ Nothing auto-executed  

If ANY checkbox is false â†’ FAILURE.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FINAL EXECUTION OATH (MANDATORY)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Before ending, you MUST print:

"I CONFIRM:
- Backend is 100% complete
- Frontend incompleteness did NOT block implementation
- No instruction was skipped
- This backend is production-ready at FirstCry scale

If this is untrue, this output is INVALID."
